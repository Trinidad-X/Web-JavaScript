<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSL Notes</title>
    <link rel="stylesheet" href="styles/notes.css">
    <style>
        /* Two-Column Layout for Editor */
        .editor-container { display: flex; gap: 10px; height: 200px; margin-bottom: 10px; }
        .editor-pane { flex: 1; display: flex; flex-direction: column; }
        .editor-pane label { font-size: 12px; font-weight: bold; margin-bottom: 2px; }
        textarea { flex: 1; resize: none; padding: 5px; font-family: monospace; border: 2px inset #fff; background: white; }
        
        /* Result Box */
        .result-box { background: white; border: 2px inset #fff; padding: 10px; min-height: 100px; overflow: auto; }
        
        /* Tables generated by XSL */
        .result-box table { border-collapse: collapse; width: 100%; }
        .result-box th, .result-box td { border: 1px solid #999; padding: 4px; text-align: left; }
        .result-box th { background-color: #eee; }
    </style>
</head>
<body style="background-color: var(--desktop-bg);">
<div class="window" style="position: fixed; top: 20px; left: 20px; right: 20px; bottom: 20px; width: auto; height: auto; resize: none;">
    <div class="title-bar">
        <div class="title-bar-text">XSL - Extensible Stylesheet Language</div>
        <div class="title-bar-controls">
            <button onclick="window.location.href='index.html'">X</button>
        </div>
    </div>
    
    <div class="window-body">
        <div class="content-area">
            <details open>
                <summary><strong>01. Live Transformation (XSLT)</strong></summary>
                <p style="font-size: 14px; margin: 5px 0;">Modify the XML or XSL below to see the HTML table generate instantly.</p>
                
                <div class="editor-container">
                    <div class="editor-pane">
                        <label>Source XML:</label>
                        <textarea id="inputXML" oninput="runXSLT()"></textarea>
                    </div>
                    <div class="editor-pane">
                        <label>Style XSL:</label>
                        <textarea id="inputXSL" oninput="runXSLT()"></textarea>
                    </div>
                </div>

                <label style="font-size: 12px; font-weight: bold;">HTML Output:</label>
                <div id="outputResult" class="result-box"></div>
            </details>

            <details>
                <summary><strong>02. Core Concepts</strong></summary>
                
                <p><strong>XSLT (Transformations):</strong> A language for transforming XML documents into other formats (like HTML, Text, or other XML).</p>
                <ul>
                    <li>It uses <strong>XPath</strong> to navigate the XML tree.</li>
                    <li>It uses <strong>Templates</strong> to define how nodes should be displayed.</li>
                </ul>
            </details>
            
            <details>
                <summary><strong>03. Common Tags</strong></summary>
                <ul>
                    <li><code>&lt;xsl:template match="/"&gt;</code>: Defines the root match.</li>
                    <li><code>&lt;xsl:for-each select="..."&gt;</code>: Loops through a set of nodes (like a JS <i>for</i> loop).</li>
                    <li><code>&lt;xsl:value-of select="..."&gt;</code>: Extracts the text value of an element.</li>
                    <li><code>&lt;xsl:sort select="..."&gt;</code>: Sorts output alphabetically or numerically.</li>
                    <li><code>&lt;xsl:if test="..."&gt;</code>: Conditional logic.</li>
                </ul>
            </details>
        </div>
    </div>
</div>

<script>
    // 1. DEFAULT DATA
    const defaultXML = `<?xml version="1.0" encoding="UTF-8"?>
<catalog>
  <cd>
    <title>Empire Burlesque</title>
    <artist>Bob Dylan</artist>
    <year>1985</year>
  </cd>
  <cd>
    <title>Hide your Heart</title>
    <artist>Bonnie Tyler</artist>
    <year>1988</year>
  </cd>
</catalog>`;

    const defaultXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
  <html>
  <body>
  <h3>My CD Collection</h3>
  <table>
    <tr>
      <th>Title</th>
      <th>Artist</th>
    </tr>
    <xsl:for-each select="catalog/cd">
    <tr>
      <td><xsl:value-of select="title"/></td>
      <td><xsl:value-of select="artist"/></td>
    </tr>
    </xsl:for-each>
  </table>
  </body>
  </html>
</xsl:template>
</xsl:stylesheet>`;

    // 2. SET INITIAL VALUES
    document.getElementById('inputXML').value = defaultXML;
    document.getElementById('inputXSL').value = defaultXSL;

    // 3. TRANSFORM FUNCTION
    function runXSLT() {
        const xmlText = document.getElementById('inputXML').value;
        const xslText = document.getElementById('inputXSL').value;
        const output = document.getElementById('outputResult');

        const parser = new DOMParser();
        
        try {
            const xmlDoc = parser.parseFromString(xmlText, "text/xml");
            const xslDoc = parser.parseFromString(xslText, "text/xml");

            if (xmlDoc.getElementsByTagName("parsererror").length > 0 || 
                xslDoc.getElementsByTagName("parsererror").length > 0) {
                output.innerHTML = "<span style='color:red'>Syntax Error in XML or XSL</span>";
                return;
            }

            if (window.XSLTProcessor) {
                const xsltProcessor = new XSLTProcessor();
                xsltProcessor.importStylesheet(xslDoc);
                const resultDocument = xsltProcessor.transformToFragment(xmlDoc, document);
                output.innerHTML = "";
                output.appendChild(resultDocument);
            } else {
                output.innerText = "Your browser does not support XSLTProcessor.";
            }
        } catch (e) {
            output.innerText = "Error: " + e.message;
        }
    }

    runXSLT();
</script>
</body>
</html>